<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <title>Java from a Parallel Universe</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="../../-revealjs-3.8.0/css/reveal.css">
  <style>
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <link rel="stylesheet" href="../../-revealjs-3.8.0/css/theme/moon.css" id="theme">
  <link rel="stylesheet" href="../parallel-highlight.css"/>
  <link rel="stylesheet" href="../theme-modifications.css"/>
  <!-- Printing and PDF exports -->
  <script>
    var link = document.createElement( 'link' );
    link.rel = 'stylesheet';
    link.type = 'text/css';
    link.href = window.location.search.match( /print-pdf/gi ) ? '../../-revealjs-3.8.0/css/print/pdf.css' : '../../-revealjs-3.8.0/css/print/paper.css';
    document.getElementsByTagName( 'head' )[0].appendChild( link );
  </script>
  <!--[if lt IE 9]>
  <script src="../../-revealjs-3.8.0/lib/js/html5shiv.js"></script>
  <![endif]-->
</head>
<body>
  <div class="reveal">
    <div class="slides">


<section><section id="java-from-a-parallel-universe" class="title-slide slide level1" data-state="page-title"><h1>Java from a Parallel Universe</h1></section><section id="jan-ouwens" class="slide level2">
<h2>Jan Ouwens</h2>
<p><br/><br/><br/><br/></p>
<p><img data-src="../images/codestar.png" style="height:30px;margin-top:5px;" /> | <a href="https://jqno.nl/equalsverifier">EqualsVerifier</a></p>
<p><img data-src="../images/twitter.png" /> <a href="https://twitter.com/jqno">jqno</a> | <a href="https://jqno.nl">jqno.nl</a></p>
<div class="preload-background-images">
<p><img data-src="../images/universe.jpg" /></p>
</div>
</section><section id="section" class="slide level2" data-background-image="../images/universe.jpg" data-background-position="bottom">
<h2></h2>
</section><section class="slide level2">

<div class="superbig">
<p>#1</p>
</div>
</section><section class="slide level2">

<div class="superbig">
<p>#10</p>
</div>
</section><section class="slide level2">

<div class="superbig">
<p>#1024579 23508726</p>
</div>
</section><section class="slide level2">

<div class="superbig">
<p>#1024579 2350x10<sup>42</sup></p>
</div>
</section><section class="slide level2">

<div class="superbig">
<p>#1024579 2350x10<sup>‚àû</sup></p>
</div>
</section><section class="slide level2">

<div class="superbig">
<p>Let me</p>
<p><strong>help</strong> you</p>
</div>
</section><section id="language-of-the-year" class="slide level2">
<h2>Language of the Year</h2>
<div class="fragment">
<p><br/></p>
<div class="superbig">
<p><strong>Parallel Java</strong></p>
</div>
<p>Java without annotations</p>
</div>
</section></section>
<section><section id="annotations" class="title-slide slide level1" data-state="page-title"><h1>Annotations</h1></section><section id="what-are-they" class="slide level2">
<h2>What are they?</h2>
<pre class="java"><code>@Override
public int hashCode() { ... }

@Test
public void something() { ... }

@JsonTypeInfo(
  use = JsonTypeInfo.Id.NAME,
  include = JsonTypeInfo.As.PROPERTY,
  property = &quot;type&quot;)
@JsonSubTypes({
  @Type(value = SubA.class, name = &quot;SubA&quot;)
})
public class Something { ... }</code></pre>
</section><section id="why" class="slide level2">
<h2>Why?</h2>
</section><section id="why-1" class="slide level2">
<h2>Why?</h2>
<p><strong>C#</strong> had them</p>
<p>¬Ø\_(„ÉÑ)_/¬Ø</p>
<p><br/></p>
<div class="stacktrace">
<ul>
<li><strong>2002</strong> ‚Üí C#</li>
<li><strong>2004</strong> ‚Üí Java</li>
<li><strong>never</strong> ‚Üí Parallel Java</li>
</ul>
</div>
</section><section id="why-2" class="slide level2">
<h2>Why?</h2>
<p>Add metadata</p>
<pre class="java"><code>@Override

@Deprecated

@SuppressWarnings(&quot;deprecation&quot;)

@Nonnull</code></pre>
</section><section id="why-3" class="slide level2">
<h2>Why?</h2>
<p>Remove external configuration (xml)</p>
<pre class="java"><code>@Inject

@Autowired

@Bean</code></pre>
</section><section id="why-4" class="slide level2">
<h2>Why?</h2>
<p>Generate code</p>
<pre class="java"><code>@Entity

@Data(staticConstructor = &quot;of&quot;)</code></pre>
</section><section id="why-5" class="slide level2">
<h2>Why?</h2>
<p>Modify runtime behavior</p>
<pre class="java"><code>@Test

@Transaction(isolation = Isolation.SERIALIZABLE)

@GetMethod(value = &quot;/endpoint/{id}&quot;,
           produces = MediaType.APPLICATION_JSON_VALUE)</code></pre>
</section><section id="how" class="slide level2">
<h2>How?</h2>
<ul>
<li>Reflection</li>
<li>Code generation</li>
</ul>
</section><section class="slide level2">

<div class="superbig">
<p>Magic</p>
</div>
<div class="preload-background-images">
<p><img data-src="../images/darkmagic.jpg" /></p>
</div>
</section><section id="section-1" class="slide level2" data-background="../images/darkmagic.jpg">
<h2></h2>
<div class="superbig">
<p>Dark¬†¬†¬†¬†¬†magic</p>
</div>
</section><section id="the-problem" class="slide level2">
<h2>The problem</h2>
<p>Checked at runtime</p>
</section><section id="the-problem-1" class="slide level2" data-state="page-bad">
<h2>The problem</h2>
<p><img data-src="../images/funtimeexceptions.png" /></p>
</section><section id="the-problem-2" class="slide level2">
<h2>The problem</h2>
<p>Weakly typed</p>
</section><section id="the-problem-3" class="slide level2" data-state="page-bad">
<h2>The problem</h2>
<p>Weakly typed</p>
<pre class="java"><code>@Autowired @Bean
@Column(name = &quot;id&quot;)
@PostMapping(&quot;/endpoint/new&quot;)
@Test
public void waitwhat() { ... }</code></pre>
</section><section id="the-problem-4" class="slide level2">
<h2>The problem</h2>
<p>Stringly typed</p>
</section><section id="the-problem-5" class="slide level2" data-state="page-bad">
<h2>The problem</h2>
<p>Stringly typed</p>
<pre class="java"><code>@PreAuthorize(&quot;isFullyAuthenticated&quot;)</code></pre>
</section><section id="the-problem-6" class="slide level2" data-state="page-good">
<h2>The problem</h2>
<p>Stringly typed</p>
<pre class="java"><code>@PreAuthorize(&quot;isFullyAuthenticated()&quot;)</code></pre>
</section><section id="the-problem-7" class="slide level2">
<h2>The problem</h2>
<p>Discoverability</p>
</section><section id="the-problem-8" class="slide level2" data-state="page-bad">
<h2>The problem</h2>
<p>Discoverability</p>
<p><img data-src="../images/discoverability.png" height="300" /></p>
</section><section id="the-problem-9" class="slide level2">
<h2>The problem</h2>
<p>Debugability</p>
</section><section id="the-problem-10" class="slide level2" data-state="page-bad">
<h2>The problem</h2>
<p>Debugability</p>
<div class="stacktrace">
<pre class="xml"><code>java.lang.IllegalArgumentException: Cannot find cache named &#39;vets&#39; for Builder[public abstract java.util.Collection com.example.petclinic.vet.VetRepository.findAll() throws org.springframework.dao.DataAccessException] caches=[vets] | key=&#39;&#39; | keyGenerator=&#39;&#39; | cacheManager=&#39;&#39; | cacheResolver=&#39;&#39; | condition=&#39;&#39; | unless=&#39;&#39; | sync=&#39;false&#39;
    at org.springframework.cache.interceptor.AbstractCacheResolver.resolveCaches(AbstractCacheResolver.java:92) ~[spring-context-5.1.5.RELEASE.jar:5.1.5.RELEASE]
    at org.springframework.cache.interceptor.CacheAspectSupport.getCaches(CacheAspectSupport.java:252) ~[spring-context-5.1.5.RELEASE.jar:5.1.5.RELEASE]
    at org.springframework.cache.interceptor.CacheAspectSupport$CacheOperationContext.&lt;init&gt;(CacheAspectSupport.java:707) ~[spring-context-5.1.5.RELEASE.jar:5.1.5.RELEASE]
    at org.springframework.cache.interceptor.CacheAspectSupport.getOperationContext(CacheAspectSupport.java:265) ~[spring-context-5.1.5.RELEASE.jar:5.1.5.RELEASE]
    at org.springframework.cache.interceptor.CacheAspectSupport$CacheOperationContexts.&lt;init&gt;(CacheAspectSupport.java:598) ~[spring-context-5.1.5.RELEASE.jar:5.1.5.RELEASE]
    at org.springframework.cache.interceptor.CacheAspectSupport.execute(CacheAspectSupport.java:345) ~[spring-context-5.1.5.RELEASE.jar:5.1.5.RELEASE]
    at org.springframework.cache.interceptor.CacheInterceptor.invoke(CacheInterceptor.java:61) ~[spring-context-5.1.5.RELEASE.jar:5.1.5.RELEASE]
    at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186) ~[spring-aop-5.1.5.RELEASE.jar:5.1.5.RELEASE]
    at org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:212) ~[spring-aop-5.1.5.RELEASE.jar:5.1.5.RELEASE]
    at com.sun.proxy.$Proxy133.findAll(Unknown Source) ~[na:na]
    at com.example.petclinic.vet.VetController.showVetList(VetController.java:44) ~[classes/:na]
    at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
    at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) ~[na:na]
    at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
    at java.base/java.lang.reflect.Method.invoke(Method.java:566) ~[na:na]
    at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:189) ~[spring-web-5.1.5.RELEASE.jar:5.1.5.RELEASE]
    at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:138) ~[spring-web-5.1.5.RELEASE.jar:5.1.5.RELEASE]
    at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:102) ~[spring-webmvc-5.1.5.RELEASE.jar:5.1.5.RELEASE]
    at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:895) ~[spring-webmvc-5.1.5.RELEASE.jar:5.1.5.RELEASE]
    at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:800) ~[spring-webmvc-5.1.5.RELEASE.jar:5.1.5.RELEASE]
    at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87) ~[spring-webmvc-5.1.5.RELEASE.jar:5.1.5.RELEASE]
    at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1038) ~[spring-webmvc-5.1.5.RELEASE.jar:5.1.5.RELEASE]
    at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:942) ~[spring-webmvc-5.1.5.RELEASE.jar:5.1.5.RELEASE]
    at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1005) ~[spring-webmvc-5.1.5.RELEASE.jar:5.1.5.RELEASE]
    at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:897) ~[spring-webmvc-5.1.5.RELEASE.jar:5.1.5.RELEASE]
    at javax.servlet.http.HttpServlet.service(HttpServlet.java:634) ~[tomcat-embed-core-9.0.16.jar:9.0.16]
    at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:882) ~[spring-webmvc-5.1.5.RELEASE.jar:5.1.5.RELEASE]
    at javax.servlet.http.HttpServlet.service(HttpServlet.java:741) ~[tomcat-embed-core-9.0.16.jar:9.0.16]
    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:231) ~[tomcat-embed-core-9.0.16.jar:9.0.16]
    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166) ~[tomcat-embed-core-9.0.16.jar:9.0.16]
    at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:53) ~[tomcat-embed-websocket-9.0.16.jar:9.0.16]</code></pre>
</div>
</section><section id="the-problem-11" class="slide level2">
<h2>The problem</h2>
<p>Difficult path to modules</p>
</section><section id="the-problem-12" class="slide level2" data-state="page-bad">
<h2>The problem</h2>
<p>Difficult path to modules</p>
<pre class="xml"><code>WARNING: An illegal reflective access operation has occurred
WARNING: Illegal reflective access by org.springframework.cglib.core.ReflectUtils$1 (jar:file:/home/huzhifeng/tmp/demo/build/libs/demo-0.0.1-SNAPSHOT.jar!/BOOT-INF/lib/spring-core-5.0.1.RELEASE.jar!/) to method java.lang.ClassLoader.defineClass(java.lang.String,byte[],int,int,java.security.ProtectionDomain)
WARNING: Please consider reporting this to the maintainers of org.springframework.cglib.core.ReflectUtils$1
WARNING: Use --illegal-access=warn to enable warnings of further illegal reflective access operations
WARNING: All illegal access operations will be denied in a future release</code></pre>
</section><section id="frameworks-and-libraries" class="slide level2">
<h2>Frameworks and libraries</h2>
<p>many existed <strong>before</strong> lambdas were introduced</p>
</section><section id="what-if" class="slide level2">
<h2>What if ‚Ä¶</h2>
<ul>
<li><p>they dropped annotations?</p></li>
<li><p>and <strong>embraced lambdas</strong>?</p></li>
</ul>
</section><section id="parallel-java" class="slide level2">
<h2>Parallel Java</h2>
<p><br/></p>
<p>No annotations!</p>
<p><br/></p>
<p>No magic!</p>
<p><br/></p>
<p>Just <strong>plain Java</strong></p>
</section></section>
<section><section id="testing" class="title-slide slide level1" data-state="page-title"><h1>Testing</h1></section><section id="in-your-universe" class="slide level2" data-state="page-bad">
<h2>In your universe</h2>
<pre class="java"><code>@Test
public void indexOfReturnsTheCorrectIndex() {
    int actual = &quot;hello world&quot;.indexOf(&#39;w&#39;);
    assertEquals(6, actual);
}</code></pre>
</section><section id="junit-3" class="slide level2" data-state="page-bad">
<h2>JUnit 3 üëπ</h2>
<pre class="java"><code>public void testIndexOfReturnsTheCorrectIndex() {
    int actual = &quot;hello world&quot;.indexOf(&#39;w&#39;);
    assertEquals(6, actual);
}</code></pre>
</section><section id="in-the-parallel-universe" class="slide level2" data-state="page-good">
<h2>In the parallel universe</h2>
<pre class="java"><code>test(&quot;indexOf returns the correct index&quot;, () -&gt; {
    int actual = &quot;hello world&quot;.indexOf(&#39;w&#39;);
    assertThat(actual).isEqualTo(6);
});</code></pre>
</section><section id="pros-cons" class="slide level2">
<h2>Pros &amp; cons</h2>
<ul>
<li><strong>Pro</strong> clear description of test</li>
<li><strong>Con</strong> ?</li>
</ul>
</section></section>
<section><section id="web" class="title-slide slide level1" data-state="page-title"><h1>Web</h1></section><section id="in-your-universe-1" class="slide level2" data-state="page-bad">
<h2>In your universe</h2>
<pre class="java"><code>@GetMapping(&quot;/todo/{id}&quot;)
public String getTodo(@PathVariable(&quot;id&quot;) String id) {
    return fetch(id);
}</code></pre>
</section><section id="in-the-parallel-universe-1" class="slide level2" data-state="page-good">
<h2>In the parallel universe</h2>
<pre class="java"><code>get(&quot;/todo/:id&quot;, (request, response) -&gt; {
    return fetch(request.params(&quot;id&quot;));
})</code></pre>
</section><section id="separating-concerns" class="slide level2" data-state="page-good">
<h2>Separating concerns</h2>
<pre class="java"><code>public void defineRoutes() {
    get(&quot;/todo/:id&quot;, this::handleGet);
}

// ...

public String handleGet(Request request, Response response) {
    return fetch(request.params(&quot;id&quot;));
}</code></pre>
</section><section id="cross-cutting-concerns" class="slide level2" data-state="page-good">
<h2>Cross-cutting concerns</h2>
<pre class="java"><code>before((request, response) -&gt; {
    if (!authenticated(request)) {
        halt(401, &quot;nope&quot;);
    }
});</code></pre>
</section><section id="pros-cons-1" class="slide level2">
<h2>Pros &amp; Cons</h2>
<ul>
<li><strong>Pro</strong> clean separation of concerns</li>
<li><strong>Pro</strong> generate endpoints</li>
<li><strong>Con</strong> ?</li>
</ul>
</section></section>
<section><section id="database" class="title-slide slide level1" data-state="page-title"><h1>Database</h1></section><section id="in-your-universe-2" class="slide level2" data-state="page-bad">
<h2>In your universe</h2>
<pre class="java"><code>@Entity
@Table(name = &quot;todo&quot;)
public class Todo {
    @Id
    @GeneratedValue
    @Column(name = &quot;id&quot;)
    private String id;

    @Column(name = &quot;title&quot;)
    private String title;

    public Todo() {
        // empty
    }
}</code></pre>
</section><section id="in-the-parallel-universe-2" class="slide level2" data-state="page-good">
<h2>In the parallel universe</h2>
<pre class="java"><code>public class Todo {
    private final String id;
    private final String title;

    // No default constructor
}</code></pre>
</section><section id="in-the-parallel-universe-3" class="slide level2" data-state="page-good">
<h2>In the parallel universe</h2>
<pre class="java"><code>List&lt;Todo&gt; todos = engine.query(handle -&gt; {
    return handle
        .createQuery(&quot;SELECT * FROM todo WHERE id = :id&quot;)
        .bind(&quot;id&quot;, id)
        .mapToBean(Todo.class)
        .list();
});</code></pre>
</section><section id="how-about-transactions" class="slide level2">
<h2>How about transactions?</h2>
<pre class="java"><code>String query = &quot;SELECT * FROM todo WHERE title = :title&quot;;
String update = &quot;UPDATE todo SET completed = TRUE WHERE id = :id&quot;;

engine.execute(handle -&gt; {
    return handle.inTransaction(h -&gt; {
        Todo todo = h.createQuery(query)
                .bind(&quot;title&quot;, &quot;rewrite annotations&quot;)
                .mapToBean(Todo.class)
                .findFirst();

        h.createUpdate(update)
                .bind(&quot;id&quot;, todo.id)
                .execute();
    });
});</code></pre>
</section><section id="pros-cons-2" class="slide level2">
<h2>Pros &amp; Cons</h2>
<ul>
<li><strong>Pro</strong> clean separation of concerns</li>
<li><strong>Pro</strong> immutable domain classes</li>
<li><strong>Pro</strong> easier debugging</li>
<li><strong>Con</strong> write SQL directly</li>
</ul>
</section></section>
<section><section id="dependency-injection" class="title-slide slide level1" data-state="page-title"><h1>Dependency Injection</h1></section><section id="di-with-spring" class="slide level2">
<h2>DI with Spring</h2>
</section><section id="di-with-spring-1" class="slide level2" data-state="page-bad">
<h2>DI with Spring</h2>
<pre class="java"><code>public class INeedSomething {
    @Autowired
    private Something needed;
}

public class IHaveSomething {
    @Bean
    public Something something = ...;
}</code></pre>
</section><section id="di-with-spring-2" class="slide level2" data-state="page-bad">
<h2>DI with Spring</h2>
<pre class="java"><code>public class INeedSomething {
    @Autowired
    public INeedSomething(Something needed) {
        // ...
    }
}

public class IHaveSomething {
    @Bean
    public Something something = ...;
}</code></pre>
</section><section id="di-with-spring-3" class="slide level2" data-state="page-bad">
<h2>DI with Spring</h2>
<pre class="java"><code>public class INeedSomething {

    public INeedSomething(Something needed) {
        // ...
    }
}

public class IHaveSomething {
    @Bean
    public Something something = ...;
}</code></pre>
</section><section id="di-with-spring-4" class="slide level2">
<h2>DI with Spring</h2>
<p>A mistake: no match</p>
</section><section id="di-with-spring-5" class="slide level2" data-state="page-bad">
<h2>DI with Spring</h2>
<pre class="java"><code>public class INeedSomething {

    public INeedSomething(Something needed) {
        // ...
    }
}

public class IHaveSomething {

    public Something something = ...;
}</code></pre>
</section><section id="di-with-spring-6" class="slide level2" data-state="page-bad">
<h2>DI with Spring</h2>
<div class="stacktrace">
<pre class="xml"><code>org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name &#39;petController&#39;: Unsatisfied dependency expressed through field &#39;something&#39;; nested exception is org.springframework.beans.factory.NoSuchBeanDefinitionException: No qualifying bean of type &#39;com.example.petclinic.model.Something&#39; available: expected at least 1 bean which qualifies as autowire candidate. Dependency annotations: {@org.springframework.beans.factory.annotation.Autowired(required=true)}
    at org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor$AutowiredFieldElement.inject(AutowiredAnnotationBeanPostProcessor.java:596) ~[spring-beans-5.1.5.RELEASE.jar:5.1.5.RELEASE]
    at org.springframework.beans.factory.annotation.InjectionMetadata.inject(InjectionMetadata.java:90) ~[spring-beans-5.1.5.RELEASE.jar:5.1.5.RELEASE]
    at org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor.postProcessProperties(AutowiredAnnotationBeanPostProcessor.java:374) ~[spring-beans-5.1.5.RELEASE.jar:5.1.5.RELEASE]
    at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.populateBean(AbstractAutowireCapableBeanFactory.java:1395) ~[spring-beans-5.1.5.RELEASE.jar:5.1.5.RELEASE]
    at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:592) ~[spring-beans-5.1.5.RELEASE.jar:5.1.5.RELEASE]
    at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:515) ~[spring-beans-5.1.5.RELEASE.jar:5.1.5.RELEASE]
    at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:320) ~[spring-beans-5.1.5.RELEASE.jar:5.1.5.RELEASE]
    at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:222) ~[spring-beans-5.1.5.RELEASE.jar:5.1.5.RELEASE]
    at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:318) ~[spring-beans-5.1.5.RELEASE.jar:5.1.5.RELEASE]
    at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:199) ~[spring-beans-5.1.5.RELEASE.jar:5.1.5.RELEASE]
    at org.springframework.beans.factory.support.DefaultListableBeanFactory.preInstantiateSingletons(DefaultListableBeanFactory.java:849) ~[spring-beans-5.1.5.RELEASE.jar:5.1.5.RELEASE]
    at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:877) ~[spring-context-5.1.5.RELEASE.jar:5.1.5.RELEASE]
    at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:549) ~[spring-context-5.1.5.RELEASE.jar:5.1.5.RELEASE]
    at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.refresh(ServletWebServerApplicationContext.java:142) ~[spring-boot-2.1.3.RELEASE.jar:2.1.3.RELEASE]
    at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:775) [spring-boot-2.1.3.RELEASE.jar:2.1.3.RELEASE]
    at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:397) [spring-boot-2.1.3.RELEASE.jar:2.1.3.RELEASE]
    at org.springframework.boot.SpringApplication.run(SpringApplication.java:316) [spring-boot-2.1.3.RELEASE.jar:2.1.3.RELEASE]
    at org.springframework.boot.SpringApplication.run(SpringApplication.java:1260) [spring-boot-2.1.3.RELEASE.jar:2.1.3.RELEASE]
    at org.springframework.boot.SpringApplication.run(SpringApplication.java:1248) [spring-boot-2.1.3.RELEASE.jar:2.1.3.RELEASE]
    at com.example.petclinic.PetClinicApplication.main(PetClinicApplication.java:32) [classes/:na]
    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:1.8.0_181]
    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) ~[na:1.8.0_181]
    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:1.8.0_181]
    at java.lang.reflect.Method.invoke(Method.java:498) ~[na:1.8.0_181]
    at org.springframework.boot.devtools.restart.RestartLauncher.run(RestartLauncher.java:49) [spring-boot-devtools-2.1.3.RELEASE.jar:2.1.3.RELEASE]
Caused by: org.springframework.beans.factory.NoSuchBeanDefinitionException: No qualifying bean of type &#39;com.example.petclinic.model.Something&#39; available: expected at least 1 bean which qualifies as autowire candidate. Dependency annotations: {@org.springframework.beans.factory.annotation.Autowired(required=true)}
    at org.springframework.beans.factory.support.DefaultListableBeanFactory.raiseNoMatchingBeanFound(DefaultListableBeanFactory.java:1654) ~[spring-beans-5.1.5.RELEASE.jar:5.1.5.RELEASE]
    at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:1213) ~[spring-beans-5.1.5.RELEASE.jar:5.1.5.RELEASE]
    at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:1167) ~[spring-beans-5.1.5.RELEASE.jar:5.1.5.RELEASE]
    at org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor$AutowiredFieldElement.inject(AutowiredAnnotationBeanPostProcessor.java:593) ~[spring-beans-5.1.5.RELEASE.jar:5.1.5.RELEASE]
    ... 24 common frames omitted</code></pre>
</div>
</section><section id="di-with-spring-7" class="slide level2">
<h2>DI with Spring</h2>
<p>A mistake: two matches</p>
</section><section id="di-with-spring-8" class="slide level2" data-state="page-bad">
<h2>DI with Spring</h2>
<pre class="java"><code>public class INeedSomething {

    public INeedSomething(Something needed) {
        // ...
    }
}

public class IHaveSomething {
    @Bean
    public Something something = ...;

    @Bean
    public Something somethingElse = ...;
}</code></pre>
</section><section id="di-with-spring-9" class="slide level2" data-state="page-bad">
<h2>DI with Spring</h2>
<div class="stacktrace">
<pre class="xml"><code>***************************
APPLICATION FAILED TO START
***************************

Description:

Field needed in com.example.petclinic.owner.PetController required a single bean, but 2 were found:
    - something: defined by method &#39;something&#39; in class path resource [com/example/petclinic/system/CacheConfiguration.class]
    - somethingElse: defined by method &#39;somethingElse&#39; in class path resource [com/example/petclinic/system/CrashController.class]


Action:

Consider marking one of the beans as @Primary, updating the consumer to accept multiple beans, or using @Qualifier to identify the bean that should be consumed</code></pre>
</div>
</section><section id="di-with-guice" class="slide level2">
<h2>DI with Guice</h2>
</section><section id="di-with-guice-1" class="slide level2" data-state="page-bad">
<h2>DI with Guice</h2>
<pre class="java"><code>public class INeedSomething {
    private final Something needed;

    @Inject
    public INeedSomething(Something needed) {
        this.needed = needed;
    }
}

public class Module extends AbstractModule {
    public void configure() {
        bind(Something.class).toInstance(...);
    }
}</code></pre>
</section><section id="di-with-guice-2" class="slide level2">
<h2>DI with Guice</h2>
<p>A mistake: no match</p>
</section><section id="di-with-guice-3" class="slide level2" data-state="page-bad">
<h2>DI with Guice</h2>
<pre class="java"><code>public class INeedSomething {
    private final Something needed;

    @Inject
    public INeedSomething(Something needed) {
        this.needed = needed;
    }
}

public class Module extends AbstractModule {
    public void configure() {
        // bind(Something.class).toInstance(...);
    }
}</code></pre>
</section><section id="di-with-guice-4" class="slide level2" data-state="page-bad">
<h2>DI with Guice</h2>
<div class="stacktrace">
<pre class="xml"><code>com.google.inject.CreationException: Unable to create injector, see the following errors:

1) No implementation for services.Counter was bound.
  while locating services.Counter
    for the 1st parameter of controllers.CountController.&lt;init&gt;(CountController.java:22)
  while locating controllers.CountController
    for the 3rd parameter of router.Routes.&lt;init&gt;(Routes.scala:38)
  at play.api.inject.RoutesProvider$.bindingsFromConfiguration(BuiltinModule.scala:123):
Binding(class router.Routes to self) (via modules: com.google.inject.util.Modules$OverrideModule -&gt; play.api.inject.guice.GuiceableModuleConversions$$anon$4)

1 error
    at com.google.inject.internal.Errors.throwCreationExceptionIfErrorsExist(Errors.java:543)
    at com.google.inject.internal.InternalInjectorCreator.initializeStatically(InternalInjectorCreator.java:159)
    at com.google.inject.internal.InternalInjectorCreator.build(InternalInjectorCreator.java:106)
    at com.google.inject.Guice.createInjector(Guice.java:87)
    at com.google.inject.Guice.createInjector(Guice.java:78)
    at play.api.inject.guice.GuiceBuilder.injector(GuiceInjectorBuilder.scala:186)
    at play.api.inject.guice.GuiceApplicationBuilder.build(GuiceApplicationBuilder.scala:139)
    at play.api.inject.guice.GuiceApplicationLoader.load(GuiceApplicationLoader.scala:21)
    at play.core.server.DevServerStart$$anon$1.$anonfun$reload$3(DevServerStart.scala:176)
    at play.utils.Threads$.withContextClassLoader(Threads.scala:22)</code></pre>
</div>
</section><section id="di-with-guice-5" class="slide level2">
<h2>DI with Guice</h2>
<p>A mistake: two matches</p>
</section><section id="di-with-guice-6" class="slide level2" data-state="page-bad">
<h2>DI with Guice</h2>
<pre class="java"><code>public class INeedSomething {
    private final Something needed;

    @Inject
    public INeedSomething(Something needed) {
        this.needed = needed;
    }
}

public class Module extends AbstractModule {
    public void configure() {
        bind(Something.class).toInstance(...);
        bind(Something.class).toInstance(...);
    }
}</code></pre>
</section><section id="di-with-guice-7" class="slide level2" data-state="page-bad">
<h2>DI with Guice</h2>
<div class="stacktrace">
<pre class="xml"><code>com.google.inject.CreationException: Unable to create injector, see the following errors:

1) A binding to services.Counter was already configured at Module.configure(Module.java:29) (via modules: com.google.inject.util.Modules$OverrideModule -&gt; Module).
  at Module.configure(Module.java:30) (via modules: com.google.inject.util.Modules$OverrideModule -&gt; Module)

1 error
    at com.google.inject.internal.Errors.throwCreationExceptionIfErrorsExist(Errors.java:543)
    at com.google.inject.internal.InternalInjectorCreator.initializeStatically(InternalInjectorCreator.java:159)
    at com.google.inject.internal.InternalInjectorCreator.build(InternalInjectorCreator.java:106)
    at com.google.inject.Guice.createInjector(Guice.java:87)
    at com.google.inject.Guice.createInjector(Guice.java:78)
    at play.api.inject.guice.GuiceBuilder.injector(GuiceInjectorBuilder.scala:186)
    at play.api.inject.guice.GuiceApplicationBuilder.build(GuiceApplicationBuilder.scala:139)
    at play.api.inject.guice.GuiceApplicationLoader.load(GuiceApplicationLoader.scala:21)
    at play.core.server.DevServerStart$$anon$1.$anonfun$reload$3(DevServerStart.scala:176)
    at play.utils.Threads$.withContextClassLoader(Threads.scala:22)</code></pre>
</div>
</section><section id="manual-di" class="slide level2">
<h2>Manual DI</h2>
</section><section id="manual-di-1" class="slide level2" data-state="page-good">
<h2>Manual DI</h2>
<pre class="java"><code>public class Main {
    public static void main(String... args) {
        Something needed = ...;
        INeedSomething iNeedSomething =
            new INeedSomething(needed);
    }
}

public class INeedSomething {
    private final Something needed;

    public INeedSomething(Something needed) {
        this.needed = needed;
    }
}</code></pre>
</section><section id="manual-di-2" class="slide level2">
<h2>Manual DI</h2>
<p>A mistake: no matches</p>
</section><section id="manual-di-3" class="slide level2" data-state="page-good">
<h2>Manual DI</h2>
<pre class="java"><code>public class Main {
    public static void main(String... args) {
        // Something needed = ...;
        INeedSomething iNeedSomething =
            new INeedSomething(needed);
    }
}</code></pre>
</section><section id="manual-di-4" class="slide level2" data-state="page-good">
<h2>Manual DI</h2>
<pre class="xml"><code>[ERROR] COMPILATION ERROR :
[ERROR] [...]/Main.java:[34,82] cannot find symbol
  symbol:   variable needed
  location: class nl.jqno.paralleljava.Main</code></pre>
</section><section id="manual-di-5" class="slide level2">
<h2>Manual DI</h2>
<p>A mistake: two matches</p>
</section><section id="manual-di-6" class="slide level2" data-state="page-good">
<h2>Manual DI</h2>
<pre class="java"><code>public class Main {
    public static void main(String... args) {
        Something needed = ...;
        Something somethingElse = ...;
        INeedSomething iNeedSomething =
            new INeedSomething(???);
    }
}</code></pre>
<div class="fragment">
<p>You have to pick!</p>
</div>
</section><section id="pros-cons-3" class="slide level2">
<h2>Pros &amp; Cons</h2>
<ul>
<li><strong>Pro</strong> problems found at compile time üçÉüçπ</li>
<li><strong>Pro</strong> clear architectural boundaries üçÉüçπ</li>
<li><strong>Pro</strong> clear error messages üçÉ</li>
<li><strong>Pro</strong> don‚Äôt need a container üçÉ</li>
<li><strong>Con</strong> 1 dirty class</li>
<li><strong>Con</strong> some boilerplate</li>
</ul>
</section></section>
<section><section id="other-annotations" class="title-slide slide level1" data-state="page-title"><h1>Other annotations</h1></section><section id="bad-annotations" class="slide level2">
<h2>Bad annotations</h2>
<ul>
<li>Serialization</li>
<li>Validation</li>
<li>Code generation</li>
</ul>
</section><section id="so-so-annotations" class="slide level2">
<h2>So-so annotations</h2>
<ul>
<li><code>@NonNull</code></li>
<li><code>@Immutable</code></li>
<li><code>@SuppressWarnings</code></li>
</ul>
</section><section id="good-annotations" class="slide level2">
<h2>Good annotations</h2>
<ul>
<li><code>@Override</code></li>
<li><code>@Deprecated</code></li>
</ul>
</section></section>
<section><section id="parallel-java-1" class="title-slide slide level1" data-state="page-title"><h1>Parallel Java</h1></section><section id="yeah-right" class="slide level2">
<h2>Yeah right</h2>
</section><section class="slide level2">

<p><br/><br/></p>
<div class="superbig">
<p>It‚Äôs all <strong>real</strong></p>
</div>
</section><section id="some-code" class="slide level2">
<h2>Some code</h2>
</section><section id="some-code-1" class="slide level2" data-state="page-good">
<h2>Some code</h2>
<pre class="yml"><code>modelVersion: 4.0.0
groupId: nl.jqno.paralleljava
artifactId: parallel-java
version: 1.0
packaging: jar
name: parallel-java

properties: {
  encoding: utf-8,
  maven.compiler.source: 11,
  maven.compiler.target: 11,
}

dependencies:
  - { groupId: com.sparkjava, artifactId: spark-core, version: 2.7.2 }
  - { groupId: com.google.code.gson, artifactId: gson, version: 2.8.5 }
  - { groupId: org.jdbi, artifactId: jdbi3-core }
  - { groupId: org.postgresql, artifactId: postgresql, version: 42.2.5 }</code></pre>
</section><section id="some-code-2" class="slide level2" data-state="page-good">
<h2>Some code</h2>
<pre class="java"><code>public void architecture() {
    test(&quot;only SparkServer and SparkServerTest access Spark classes&quot;, () -&gt; {
        assertBoundary(&quot;spark..&quot;, SparkServer.class.getPackage());
    });

    test(&quot;only DatabaseRepository accesses Engine classes&quot;, () -&gt; {
        assertBoundary(&quot;org.jdbi..&quot;, DatabaseRepository.class.getPackage());
    });
}</code></pre>
</section><section id="some-code-3" class="slide level2" data-state="page-good">
<h2>Some code</h2>
<pre class="java"><code>public void run() {
    port(port);
    enableCors();

    get(endpoint, (req, resp) -&gt; controller.get());
    get(endpoint + &quot;/:id&quot;, (req, resp) -&gt; controller.get(req.params(&quot;id&quot;)));
    post(endpoint, (req, resp) -&gt; controller.post(req.body()));
}</code></pre>
</section><section id="some-code-4" class="slide level2" data-state="page-good">
<h2>Some code</h2>
<pre class="java"><code>public Try&lt;Void&gt; create(Todo todo) {
    return engine.execute(handle -&gt; {
        String sql = &quot;INSERT INTO todo (id, title, completed, index)&quot; +
            &quot;VALUES (:id, :title, :completed, :order)&quot;;
        return handle.createUpdate(sql)
            .bind(&quot;id&quot;, todo.id().toString())
            .bind(&quot;title&quot;, todo.title())
            .bind(&quot;completed&quot;, todo.completed())
            .bind(&quot;order&quot;, todo.order())
            .execute());
    }
}</code></pre>
</section><section id="some-code-5" class="slide level2" data-state="page-good">
<h2>Some code</h2>
<pre class="java"><code>public class Main {
    public static void main(String... args) {
        LoggerFactory loggerFactory =
                c -&gt; new Slf4jLogger(org.slf4j.LoggerFactory.getLogger(c));

        // ...

        var todoMapper = new TodoMapper(fullUrl);
        var dbEngine = new JdbiEngine(jdbcUrl, todoMapper, loggerFactory);
        var repository = new DatabaseRepository(dbEngine);

        var idGenerator = new RandomIdGenerator();
        var serializer = GsonSerializer.create(loggerFactory);
        var controller = new DefaultController(fullUrl, repository, idGenerator, serializer, loggerFactory);
        var server = new SparkServer(Environment.ENDPOINT, port, controller, loggerFactory);

        var runner = new Runner(repository, server, loggerFactory);
        runner.startup();
    }
}</code></pre>
</section><section id="libraries" class="slide level2">
<h2>Libraries</h2>
<ul>
<li><a href="http://sparkjava.com/">SparkJava</a></li>
<li><a href="http://jdbi.org/">JDBI</a></li>
<li><a href="https://github.com/jqno/PicoTest">PicoTest</a></li>
<li>Enforced by <a href="https://checkstyle.org/">Checkstyle</a></li>
</ul>
</section><section id="demo-application" class="slide level2">
<h2>Demo application</h2>
<p><br/></p>
<p><img data-src="../images/github.png" /></p>
<p><a href="https://github.com/jqno/paralleljava">github.com/jqno/paralleljava</a></p>
</section></section>
<section><section id="conclusion" class="title-slide slide level1" data-state="page-title"><h1>Conclusion</h1></section><section id="conclusion-1" class="slide level2">
<h2>Conclusion</h2>
<p>Think about your <strong>libraries</strong></p>
<div class="fragment">
<p><br/></p>
<p>Do you really need them?</p>
<p>Are they good citizens?</p>
</div>
</section><section id="conclusion-2" class="slide level2">
<h2>Conclusion</h2>
<p>Think about your <strong>frameworks</strong></p>
<div class="fragment">
<p><br/></p>
<p>Will they infect your architecture?</p>
<p>Are there alternatives? <br/> <small>(<a href="https://spring.io/blog/2016/09/22/new-in-spring-5-functional-web-framework">Spring Functional Web Framework</a>)</small></p>
</div>
</section><section id="conclusion-3" class="slide level2">
<h2>Conclusion</h2>
<p>Think about your <strong>languages</strong></p>
<div class="fragment">
<p><br/></p>
<ul>
<li><strong>Parallel Java</strong></li>
<li>Scala</li>
<li>Kotlin</li>
<li>‚Ä¶</li>
</ul>
<div class="preload-background-images">
<p><img data-src="../images/universe.jpg" /></p>
</div>
</div>
</section><section id="conclusion-4" class="slide level2" data-background-image="../images/universe.jpg" data-background-position="bottom">
<h2>Conclusion</h2>
<p>Think about your <strong>universe</strong></p>
</section></section>
<section id="questions" class="title-slide slide level1" data-state="page-title"><h1>Questions?</h1><p><br/></p>
<p><img data-src="../images/qr.png" /></p>
<p><a href="http://jqno.nl/talks/paralleljava">jqno.nl/talks/paralleljava</a></p></section>
    </div>
  </div>

  <script src="../../-revealjs-3.8.0/lib/js/head.min.js"></script>
  <script src="../../-revealjs-3.8.0/js/reveal.js"></script>

  <script>

      // Full list of configuration options available at:
      // https://github.com/hakimel/reveal.js#configuration
      Reveal.initialize({
        // Display controls in the bottom right corner
        controls: false,
        // Display a presentation progress bar
        progress: false,
        // Push each slide change to the browser history
        history: true,
        // Vertical centering of slides
        center: false,
        // Transition style
        transition: 'none', // none/fade/slide/convex/concave/zoom
        // Transition style for full page slide backgrounds
        backgroundTransition: 'none', // none/fade/slide/convex/concave/zoom

        // Optional reveal.js plugins
        dependencies: [
          { src: '../../-revealjs-3.8.0/lib/js/classList.js', condition: function() { return !document.body.classList; } },
          { src: '../../-revealjs-3.8.0/plugin/zoom-js/zoom.js', async: true },
          { src: '../../-revealjs-3.8.0/plugin/highlight/highlight.js', async: true },
          { src: '../../-revealjs-3.8.0/plugin/notes/notes.js', async: true }
        ]
      });
    </script>
    </body>
</html>

